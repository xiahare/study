select `hash_id`,`adomid` as __adomid ,`__start_time`,`__end_time`, __adom_row_no*10000000+adomid as row_no,cast(__adom_row_no as int) as `slot`, `adomid`, `app_group`, `appcat`, `service`, `bandwidth`, `traffic_in`, `traffic_out`, `sessions` from (select 111 as `hash_id`,'%s' as __start_time, '%s' as __end_time, row_number() over( partition by adomid order by `sessions` desc) as __adom_row_no , `adomid`, `app_group`, `appcat`, `service`, `bandwidth`, `traffic_in`, `traffic_out`, `sessions` from(/*HCACHE-RPT-AUTO ({0}.fgt_traffic)*/select adomid as `adomid`,  app_group_name(app) as app_group, appcat, service, sum(coalesce(sentdelta, sentbyte, 0)+coalesce(rcvddelta, rcvdbyte, 0)) as bandwidth, sum(coalesce(rcvddelta, rcvdbyte, 0)) as traffic_in, sum(coalesce(sentdelta, sentbyte, 0)) as traffic_out, count(*) as sessions from (select * from __i4malgiu_fgt_traffic_view where itime>='%s' and itime<='%s' )  t1 where (1=1) and (logflag&(1|32)>0) and nullifna(app) is not null group by `adomid`,  app_group, appcat, service order by bandwidth desc) __original_sql  ) __partition_sql where adomid=2693 and __adom_row_no<=10 and app_group='NTP'